import{bi as f}from"./index-BWmc9D7q.js";import{u}from"./useApi-DxPB8i99.js";import{c as l}from"./createUrl-DKBmGA7R.js";import{$ as C}from"./api-BR-notFO.js";const M=f("chat",{state:()=>({contacts:[],chatsContacts:[],profileUser:void 0,activeChat:null}),actions:{async fetchChatsAndContacts(s){const{data:a,error:c}=await u(l("/apps/chat/chats-and-contacts",{query:{q:s}}));if(c.value)console.log(c.value);else{const{chatsContacts:t,contacts:e,profileUser:i}=a.value;this.chatsContacts=t,this.contacts=e,this.profileUser=i}},async getChat(s){const a=await C(`/apps/chat/chats/${s}`);this.activeChat=a},async sendMsg(s){var n,o,r,d,p;const a=(n=this.profileUser)==null?void 0:n.id,c=await C(`apps/chat/chats/${(o=this.activeChat)==null?void 0:o.contact.id}`,{method:"POST",body:{message:s,senderId:a}}),{msg:t,chat:e}=c;if(e!==void 0){const h=this.activeChat;this.chatsContacts.push({...h.contact,chat:{id:e.id,lastMessage:[],unseenMsgs:0,messages:[t]}}),this.activeChat&&(this.activeChat.chat={id:e.id,messages:[t],unseenMsgs:0,userId:(r=this.activeChat)==null?void 0:r.contact.id})}else(p=(d=this.activeChat)==null?void 0:d.chat)==null||p.messages.push(t);const i=this.chatsContacts.find(h=>this.activeChat?h.id===this.activeChat.contact.id:!1);i.chat.lastMessage=t}}});export{M as u};
